# 3Dメッシュの基本概念とGazeboでの活用

## メッシュとは

**メッシュ（Mesh）**とは、3Dオブジェクトの**形状を表現するデータ構造**のことです。

## 基本構成要素

### 1. 頂点（Vertices）
- 3D空間上の点の座標（x, y, z）
- 例: `(0, 0, 0)`, `(1, 0, 0)`, `(0, 1, 0)`

### 2. 面（Faces/Polygons）
- 頂点同士を結んで作る平面
- 通常は三角形（Triangle）または四角形（Quad）

### 3. エッジ（Edges）
- 頂点同士を結ぶ線

## 視覚的イメージ

```
簡単な立方体メッシュの例:

頂点: 8個の角の点
エッジ: 12本の辺
面: 6つの四角形面（または12個の三角形面）

    E -------- F
   /|         /|
  / |        / |
 A -------- B  |
 |  H ------|--G
 | /        | /
 |/         |/
 D -------- C
```

## Gazeboでのメッシュの役割

### 1. 視覚用メッシュ（Visual Mesh）
**目的**: オブジェクトの**見た目**を決定

**特徴**:
- 高詳細（多くの面数）
- テクスチャ・マテリアル情報を含む
- カメラでの表示品質に影響
- センサーシミュレーション（LiDAR、カメラ）の精度に重要

### 2. コリジョン用メッシュ（Collision Mesh）
**目的**: 物理計算での**当たり判定**

**特徴**:
- 低詳細（少ない面数）
- 形状の境界のみ重要
- 計算速度に直接影響
- ロボットの移動・パスプランニングに使用

## ファイル形式との関係

### .dae（COLLADA）ファイル
```
メッシュデータ + 追加情報:
├── 頂点座標
├── 面情報
├── マテリアル（色、反射率など）
├── テクスチャ（画像ファイル参照）
└── UV座標（テクスチャの貼り方）
```

**用途**: 視覚用メッシュに最適

### .stl（STereoLithography）ファイル
```
メッシュデータのみ:
├── 頂点座標
├── 面情報（三角形のみ）
└── 法線ベクトル

※ マテリアル・テクスチャ情報なし
```

**用途**: コリジョン用メッシュに最適（軽量）

## 実際の例: 建物のメッシュ

### 視覚用メッシュ（詳細版）
- **含む要素**:
  - 窓枠の細かい凹凸
  - ドアノブの形状
  - 壁面のテクスチャ
  - 装飾的な要素
- **面数**: 50,000面
- **用途**: カメラ・LiDARセンサーでの認識

### コリジョン用メッシュ（簡略化版）
- **含む要素**:
  - 基本的な建物の外形のみ
  - 窓は単純な平面
  - 主要な障害物の形状
- **面数**: 5,000面
- **用途**: ロボットの移動・衝突検知

## メッシュの重要性

### 1. 計算負荷
- **面数が多い** → 計算時間増加
- **面数が少ない** → 高速計算

### 2. 精度
- **詳細なメッシュ** → 正確な形状表現
- **簡略化メッシュ** → 基本形状のみ

### 3. メモリ使用量
- **複雑なメッシュ** → 大容量メモリ必要
- **シンプルなメッシュ** → 軽量

## メッシュ最適化の指針

### 視覚用メッシュ
```
優先事項: 見た目の品質
面数: 10,000～50,000面
考慮点:
- センサー精度への影響
- テクスチャの解像度
- マテリアルの物理的特性
```

### コリジョン用メッシュ
```
優先事項: 計算速度
面数: 1,000～5,000面
考慮点:
- 基本形状の保持
- 重要な凹凸のみ残す
- 装飾要素は削除
```

## Blenderでのメッシュ編集

### 面数確認方法
```
1. オブジェクト選択
2. 画面右上の統計情報で確認
   - Verts: 頂点数
   - Faces: 面数
   - Tris: 三角形数
```

### 面数削減（Decimate Modifier）
```
1. Modifier Properties → Add Modifier → Decimate
2. Type: Collapse
3. Ratio: 0.1～0.3（元の10-30%に削減）
4. Apply で適用
```

## まとめ

**メッシュ**とは3Dオブジェクトの**デジタル上での形状表現方法**であり、Gazeboでは:

- **視覚用メッシュ**: ロボットセンサーが「見る」形状
- **コリジョン用メッシュ**: ロボットが「当たる」形状

この2つを適切に使い分けることで、**高品質な見た目**と**高速な物理計算**を両立できます。